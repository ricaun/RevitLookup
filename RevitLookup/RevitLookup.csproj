<?xml version="1.0" encoding="utf-8"?>
<Project Sdk="Microsoft.NET.Sdk">
    <PropertyGroup>
        <AssemblyName>RevitLookup</AssemblyName>
        <TargetFramework>net48</TargetFramework>
        <OutputType>Library</OutputType>
        <UseWpf>true</UseWpf>
        <Version>2022.0.2.5</Version>
        <UseWindowsForms>true</UseWindowsForms>
        <AppendTargetFrameworkToOutputPath>false</AppendTargetFrameworkToOutputPath>
        <LangVersion>9</LangVersion>
        <PlatformTarget>x64</PlatformTarget>
    </PropertyGroup>
    <PropertyGroup>
        <RevitVersion>2022</RevitVersion>
    </PropertyGroup>

    <ItemGroup>
        <PackageReference Include="Revit_API_x64" Version="$(RevitVersion).0.0" />
    </ItemGroup>

    <ItemGroup>
        <Resource Include="Resources\Images\RLookup-16.ico" />
        <Resource Include="Resources\Images\RLookup-16.png" />
        <Resource Include="Resources\Images\RLookup-32.png" />
    </ItemGroup>

    <ItemGroup>
        <None Update="RevitLookup.addin">
            <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
        </None>
    </ItemGroup>

    <ItemGroup>
        <AddinDll Include="$(TargetDir)$(AssemblyName).dll" />
    </ItemGroup>

    <Target Name="AfterBuildTarget" AfterTargets="CoreBuild">
        <PropertyGroup>
            <AddinDir>bin\AddIn $(RevitVersion) $(Configuration)\</AddinDir>
            <OutAddinDir>$(AddinDir)$(AssemblyName)\</OutAddinDir>
        </PropertyGroup>

        <Copy SourceFiles="$(TargetDir)$(AssemblyName).addin" DestinationFolder="$(AddinDir)" />
        <Copy SourceFiles="@(AddinDll)" DestinationFolder="$(OutAddinDir)" />

        <ItemGroup>
            <OutLibPath Include="$(AddinDir)**\*.*" />
        </ItemGroup>
        <Copy SourceFiles="@(OutLibPath)" DestinationFolder="$(AppData)\Autodesk\Revit\Addins\$(RevitVersion)\%(RecursiveDir)" />
    </Target>
</Project>
